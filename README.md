# triage-workflow

## Overview

**triage-workflow** is an automation toolkit for managing application security findings across multiple scan types (SAST, SCA, CSEC, DAST) using Checkmarx and Jira integrations. It streamlines the extraction, triage, and update of vulnerability states, severities, and scores, enabling security teams to efficiently process and track findings.

## Features

- Automated extraction of vulnerability details from Checkmarx scans
- Triage and update of findings (state, severity, score) via API
- Integration with Jira for ticket creation and updates
- Support for SAST (Static Analysis), SCA (Software Composition Analysis), CSEC (Container Security), and DAST (Dynamic Analysis) workflows
- Modular utility scripts for HTTP requests, logging, configuration, and helper functions
- Configurable field mappings and user types

## Project File Structure

```
appsec_triage_create_subtask.py
appsec_triage_get_vulnerability_details.py
appsec_triage_main.py
appsec_triage_update_cx_findings.py
checkmarx_utility/
    ├── .env_sample
    ├── cx_api_actions.py
    ├── cx_api_endpoints.py
    ├── cx_config_utility.py
    ├── cx_token_manager.py
config/
    ├── field_mapping.yml
    ├── user_type.yml
.github/
    └── workflows/
        ├── appsec_workflow.yml
        ├── appsec_triage_update_workflow.yml
        ├── jira_create_subtask.yml
.gitignore
jira_utility/
    ├── __init__.py
    ├── .env_sample
    ├── helper_functions.py
    ├── jira_api_actions.py
    ├── jira_api_endpoints.py
    ├── jira_config_utility.py
logs/
README.md
requirements.txt
utils/
    ├── exception_handler.py
    ├── helper_functions.py
    ├── http_utility.py
    ├── json_file_utility.py
    ├── logger.py
    ├── yml_file_utility.py
```

### File/Directory Descriptions

- **appsec_triage_create_subtask.py**: Script to create Jira subtasks for findings that require remediation or further investigation.
- **appsec_triage_get_vulnerability_details.py**: Extracts and formats detailed vulnerability information from Checkmarx scans.
- **appsec_triage_main.py**: Main entry point for orchestrating the triage workflow, integrating extraction, triage, and ticketing.
- **appsec_triage_update_cx_findings.py**: Automates the triage update process for findings, mapping Jira statuses to Checkmarx states/severities/scores and updating them via API.
- **checkmarx_utility/**: Directory containing modules for Checkmarx API actions, endpoint definitions, configuration, and token management.
  - **.env_sample**: Example environment variable file for Checkmarx API configuration.
  - **cx_api_actions.py**: Functions for interacting with Checkmarx APIs.
  - **cx_api_endpoints.py**: Endpoint definitions for Checkmarx APIs.
  - **cx_config_utility.py**: Utilities for Checkmarx configuration management.
  - **cx_token_manager.py**: Handles Checkmarx API authentication tokens.
- **config/**: Directory for configuration files.
  - **field_mapping.yml**: YAML file mapping fields between Jira and Checkmarx.
  - **user_type.yml**: YAML file defining user types and roles.
- **.github/**: GitHub configuration directory.
  - **workflows/**: Contains GitHub Actions workflow files for CI/CD automation.
    - **appsec_workflow.yml**: Workflow for main AppSec automation.
    - **appsec_triage_update_workflow.yml**: Workflow for updating triage findings.
    - **jira_create_subtask.yml**: Workflow for automating Jira subtask creation.
- **.gitignore**: Specifies files and directories to be ignored by git.
- **jira_utility/**: Directory containing modules for Jira API actions, endpoint definitions, configuration, and helper functions.
  - **__init__.py**: Marks the directory as a Python package.
  - **.env_sample**: Example environment variable file for Jira API configuration.
  - **helper_functions.py**: Helper functions for Jira integration.
  - **jira_api_actions.py**: Functions for interacting with Jira APIs.
  - **jira_api_endpoints.py**: Endpoint definitions for Jira APIs.
  - **jira_config_utility.py**: Utilities for Jira configuration management.
- **logs/**: Directory for log files generated by the scripts.
- **README.md**: Project documentation file.
- **requirements.txt**: Python dependencies required for the project.
- **utils/**: Shared utility modules for HTTP requests, logging, exception handling, YAML/JSON file management, and helper functions.
  - **exception_handler.py**: Decorator and utilities for exception handling.
  - **helper_functions.py**: General-purpose helper functions.
  - **http_utility.py**: HTTP request abstraction and error handling.
  - **json_file_utility.py**: Utilities for working with JSON files.
  - **logger.py**: Logging utilities.
  - **yml_file_utility.py**: Utilities for working with YAML files.

## How It Works

The workflow consists of Python scripts that interact with Checkmarx and Jira APIs to:
- Extract scan and vulnerability details
- Map triage statuses to Checkmarx states/severities/scores
- Update findings in Checkmarx based on triage decisions
- Optionally create or update Jira tickets for tracking and remediation

## Script Descriptions

- **appsec_triage_get_vulnerability_details.py**  
  Extracts detailed vulnerability information from Checkmarx scans (SAST, SCA, CSEC, DAST) and formats it for reporting or integration.

- **appsec_triage_update_cx_findings.py**  
  Automates the triage update process for findings, mapping Jira statuses to Checkmarx states/severities/scores and updating them via API.

- **appsec_triage_create_subtask.py**  
  (If present) Creates Jira subtasks for findings requiring remediation or further investigation.

- **appsec_triage_main.py**  
  Entry point for orchestrating the workflow, integrating extraction, triage, and ticketing.

- **checkmarx_utility/**  
  Contains modules for Checkmarx API actions, endpoint definitions, configuration, and token management.

- **jira_utility/**  
  Contains modules for Jira API actions, endpoint definitions, configuration, and helper functions.

- **utils/**  
  Shared utilities for HTTP requests, logging, exception handling, YAML/JSON file management, and helper functions.

## Requirements

- Python 3.8+
- Dependencies listed in `requirements.txt`
- Access to Checkmarx and Jira APIs (with credentials/configuration)
- Configuration files in `config/` for field mapping and user types

## Local Machine Configuration

Before running the scripts in your local machine, you must configure environment variables for both Checkmarx and Jira integrations.

### Checkmarx Configuration

1. Copy the sample environment file:
   ```
   cp checkmarx_utility/.env_sample checkmarx_utility/.env
   ```
2. Open `checkmarx_utility/.env` and fill in the required values:
   - `CHECKMARX_API_URL`: The base URL for your Checkmarx API instance.
   - `CHECKMARX_USERNAME`: Your Checkmarx username.
   - `CHECKMARX_PASSWORD`: Your Checkmarx password or API token.
   - `CHECKMARX_TENANT` (if applicable): The tenant or organization name.
   - Any other variables as specified in the sample file.

### Jira Configuration

1. Copy the sample environment file:
   ```
   cp jira_utility/.env_sample jira_utility/.env
   ```
2. Open `jira_utility/.env` and fill in the required values:
   - `JIRA_API_URL`: The base URL for your Jira instance (e.g., `https://yourcompany.atlassian.net`).
   - `JIRA_USERNAME`: Your Jira username or email.
   - `JIRA_API_TOKEN`: Your Jira API token or password.
   - Any other variables as specified in the sample file.

> **Tip:** Never commit your `.env` files with real credentials to version control. Use the `.env_sample` files as templates for new environments.

## Usage

1. Install dependencies:
   ```
   pip install -r requirements.txt
   ```
2. Configure API credentials and field mappings in the `config/` directory.
3. Run the main workflow:
   ```
   python appsec_triage_main.py
   ```
4. Use individual scripts for extraction or triage updates as needed:
   ```
   python appsec_triage_get_vulnerability_details.py
   python appsec_triage_update_cx_findings.py
   ```

## Support

For issues or questions, open an issue in the repository or contact the project maintainer.

## Authors and Acknowledgments

Developed by the Ensign InfoSecurity AppSec Automation Team.

## License

See LICENSE file for details.

## Project Status

Actively maintained and open to contributions.
